
var holdEnter = 0;
var mouseMove = 0;
var isActive = 0;
var isShown = 0;
var tags = '';
var i = 1;

var inactive = setTimeout(function () {
    goInactive();
}, 5000);

$(function () {
    if (isidle == 1) {
        $('#idleModal').modal('show');
    }
});

var url = $(location).attr("href"), parts = url.split("/"), last_part = parts[parts.length - 1];
if (last_part != "userassit" && last_part != "") {
    $(document).idle({onIdle: function () {
            if (isActive == 0) {
                if (isShown == 0) {
                    idleAccount();
                }
            }
        }, idle: 200000});
}
;
function idleAccount() {
    isShown = 1;
    $('#idleModal').modal('show');
    window.localStorage.setItem('state', '0');
    $.ajax
            ({
                type: 'POST',
                url: "userassist/isIdle",
                data: {idleacc: 1
                },
                dataType: 'json'
            })
            .done(function (data)
            {
            });
}





function tabIsActive() {
    clearTimeout(inactive);
    if (mouseMove == 0) {
        isActive = 1;
        mouseMove = 1;
        window.localStorage.setItem('mouseMoved', 1);
    }
    checkIsActive();
}

function checkIsActive() {
    inactive = setTimeout(function () {
        goInactive();
    }, 200000);
}


function goInactive() {
    isActive = 0;
    mouseMove = 0;
    window.localStorage.setItem('mouseMoved', 0);
    checkIsActive();
}


function tableInputKeyPress(e) {
    e = e || window.event;
    var key = e.keyCode;
    if (key == 13)
    {
        if (holdEnter == 0) {

            checkpassword();
            holdEnter = 1;
        }
        return false;
    }
}






window.addEventListener('storage', function (event) {

    if (event.storageArea.state == 1) {
        $('#idleModal').modal('hide');
        isidle = 0;
        isShown = 0;
    } else {
        if (isShown == 0) {
            $('#idleModal').modal('show');
            isidle = 1;
            isShown = 1;
        }
    }

    if (event.storageArea.mouseMoved == 1) {
        isActive = 1;
        mouseMove = 1;
    } else {
        isActive = 0;
        mouseMove = 0;
    }
});






function useronlyPayslip(empname, profileno) {

    $('#payslipmodal').modal('show');

    $('#payslipname').html(empname);
    $('#passcode').val(profileno);


    var payslipdate = $('#search-payslipmodal-form input[name=payslipdate]').val();
    var passcodex = $('#passcode').val();
    $('#payslip-modal-table').dataTable().fnDestroy();
    var table = $('#payslip-modal-table').DataTable
            ({
                dom: 'frtip',
                responsive: true,
                processing: true,
                serverSide: true,
                order: [],
                oLanguage: {sProcessing: '<div><img class="zmdi-hc-spin" src="' + 'assets/images/logo.png' + '" style="width:40px; height:40px" alt="Drainwiz"><br><br><label>Processing Data...</label></div>'},
                ajax:
                        {
                            url:  "userassist/fetch_payslip",
                            type: "POST",
                            data: {passcode: passcodex, month: payslipdate}
                        },

                initComplete: function (settings, json)
                {

                }
            });

    $('#payslip-table_filter input').unbind();
    $('#payslip-table_filter input').bind('keyup', function (e)
    {
        if (e.keyCode == 13)
        {
            table.fnFilter(this.value);
        }
    });


}










function reInitializeDataTable(datatable, table_id) {
    if (datatable != null) {
        $('#' + table_id).DataTable().clear().destroy();
    }
}

$('*').bind('mousemove ', function () {
    tabIsActive();
});
$(window).focus(function () {
    tabIsActive();
});
$(window).blur(function () {
    tabIsActive();
});

window.onscroll = function (e) {
    tabIsActive();
}



function timeKeyUp(e, element_id) {
    e = e || window.event;
    var key = e.keyCode;
    if (key == 48) {
        if ($('#' + element_id).val() == '') {
            $('#' + element_id).val(time);
        }

    }
}

function timeKeyDown(element_id) {
    time = $('#' + element_id).val();
}









